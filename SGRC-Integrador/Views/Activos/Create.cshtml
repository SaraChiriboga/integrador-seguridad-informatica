<div class="container fade-in">
    <div class="form-header">
        <button class="btn-back" onclick="loadView('@Url.Action("Index", "Activos")')">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h3>Registrar Nuevo Activo</h3>
    </div>

    <form id="formActivo" action="@Url.Action("Create", "Activos")" method="post">
        <div class="form-grid">
            <!-- Información General -->
            <div class="card-form">
                <h5 class="card-form-title">
                    <i class="fas fa-info-circle"></i>
                    Información General
                </h5>

                <div class="form-group-modern">
                    <label class="form-label-modern">Nombre del Activo</label>
                    <input type="text" name="Nombre" class="form-input-modern" required placeholder="Ej: Servidor Oracle">
                </div>

                <div class="form-group-modern">
                    <label class="form-label-modern">Tipo de Activo</label>
                    <select name="Tipo" class="form-select-modern" required>
                        <option value="" disabled selected>Seleccione el tipo...</option>
                        <optgroup label="Infraestructura Tecnológica">
                            <option value="HW">Hardware (Servidores, Redes)</option>
                            <option value="SW">Software (Sistemas, Apps)</option>
                        </optgroup>
                        <optgroup label="Información">
                            <option value="DATOS">Datos / Bases de Datos</option>
                        </optgroup>
                        <optgroup label="Organizacional">
                            <option value="PERSONAL">Personal / RRHH</option>
                            <option value="SERV">Servicios (Nube, Web)</option>
                            <option value="INST">Instalaciones (Data Center, Oficinas)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group-modern">
                    <label class="form-label-modern">Ubicación</label>
                    <input type="text" name="Ubicacion" class="form-input-modern" placeholder="Ej: Rack 4 - DC Quito">
                </div>
            </div>

            <!-- Valoración -->
            <div class="card-form card-valoracion">
                <h5 class="card-form-title">
                    <i class="fas fa-shield-alt"></i>
                    Valoración de Seguridad
                </h5>

                <div class="slider-group-modern">
                    <div class="slider-header-modern">
                        <span class="slider-label-modern">
                            <i class="fas fa-lock"></i>
                            Confidencialidad
                        </span>
                        <span class="slider-value-modern" id="valC">1</span>
                    </div>
                    <input type="range" class="form-range" name="ValorC" id="slideC" min="1" max="4" value="1" oninput="updateSlider('slideC', 'valC')">
                </div>

                <div class="slider-group-modern">
                    <div class="slider-header-modern">
                        <span class="slider-label-modern">
                            <i class="fas fa-check-circle"></i>
                            Integridad
                        </span>
                        <span class="slider-value-modern" id="valI">1</span>
                    </div>
                    <input type="range" class="form-range" name="ValorI" id="slideI" min="1" max="4" value="1" oninput="updateSlider('slideI', 'valI')">
                </div>

                <div class="slider-group-modern">
                    <div class="slider-header-modern">
                        <span class="slider-label-modern">
                            <i class="fas fa-bolt"></i>
                            Disponibilidad
                        </span>
                        <span class="slider-value-modern" id="valD">1</span>
                    </div>
                    <input type="range" class="form-range" name="ValorD" id="slideD" min="1" max="4" value="1" oninput="updateSlider('slideD', 'valD')">
                </div>

                <div class="result-display-modern">
                    <div class="result-label-modern">Valor Total</div>
                    <div class="result-value-modern" id="txtTotal">3</div>
                    <span class="result-badge-modern badge-bajo" id="badgeNivel">Activo Bajo</span>
                </div>
            </div>
        </div>

        <div class="form-actions-modern">
            <button type="button" class="btn-modern btn-secondary-modern" onclick="cancelarFormulario()">
                <i class="fas fa-times"></i>
                Cancelar
            </button>
            <button type="submit" class="btn-modern btn-primary-modern">
                <i class="fas fa-save"></i>
                Guardar Activo
            </button>
        </div>
    </form>
</div>

<script>
    // Interceptar el envío del formulario para usar AJAX
    $('#formActivo').submit(function (e) {
        e.preventDefault();
        var form = $(this);
        $.post(form.attr('action'), form.serialize(), function (response) {
            $('#main-content').html(response);
        });
    });

    // Actualizar valor del slider
    function updateSlider(sliderId, displayId) {
        const value = document.getElementById(sliderId).value;
        document.getElementById(displayId).innerText = value;
        calcTotal();
    }

    // Calcular total
    function calcTotal() {
        let c = parseInt(document.getElementById('slideC').value);
        let i = parseInt(document.getElementById('slideI').value);
        let d = parseInt(document.getElementById('slideD').value);
        let total = c + i + d;

        document.getElementById('txtTotal').innerText = total;

        let badge = document.getElementById('badgeNivel');
        badge.className = "result-badge-modern";

        if (total >= 10) {
            badge.innerText = "CRÍTICO - Joya de la Corona";
            badge.classList.add("badge-critico");
        } else if (total >= 7) {
            badge.innerText = "Activo Importante";
            badge.classList.add("badge-importante");
        } else {
            badge.innerText = "Activo Bajo";
            badge.classList.add("badge-bajo");
        }
    }

    // Cancelar formulario
    function cancelarFormulario() {
        if (confirm('¿Está seguro de cancelar? Se perderán los datos ingresados.')) {
            loadView('@Url.Action("Index", "Activos")');
        }
    }

    // Inicializar
    calcTotal();
</script>